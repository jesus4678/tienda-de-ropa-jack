<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Ofertas y Promociones - Tienda de Ropa</title>
    <style>
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #2196F3;
            --error-color: #f44336;
            --success-color: #4CAF50;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .admin-panel, .user-panel {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }

        button:hover {
            opacity: 0.9;
        }

        .promotion-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .promotion-card {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .promotion-card h3 {
            margin-top: 0;
            color: var(--primary-color);
        }

        .status-active {
            color: var(--success-color);
            font-weight: bold;
        }

        .status-inactive {
            color: var(--error-color);
        }

        .notification {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .success {
            background-color: #dff0d8;
            color: #3c763d;
        }

        .error {
            background-color: #f2dede;
            color: #a94442;
        }

        .cart-summary {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Panel de Administración -->
        <div class="admin-panel">
            <h2>Panel de Administración de Ofertas</h2>
            <form id="promotionForm">
                <div class="form-group">
                    <label for="promoName">Nombre de la Promoción:</label>
                    <input type="text" id="promoName" required>
                </div>
                <div class="form-group">
                    <label for="promoType">Tipo de Promoción:</label>
                    <select id="promoType" required>
                        <option value="percentage">Descuento Porcentual</option>
                        <option value="fixed">Descuento Fijo</option>
                        <option value="buyOneGetOne">2x1</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="promoValue">Valor del Descuento:</label>
                    <input type="number" id="promoValue" required>
                </div>
                <div class="form-group">
                    <label for="promoCode">Código de Cupón:</label>
                    <input type="text" id="promoCode" required>
                </div>
                <div class="form-group">
                    <label for="promoExpiry">Fecha de Expiración:</label>
                    <input type="date" id="promoExpiry" required>
                </div>
                <button type="submit">Crear Promoción</button>
            </form>

            <div id="promotionList" class="promotion-list">
                <!-- Las promociones se agregarán aquí dinámicamente -->
            </div>
        </div>

        <!-- Panel de Usuario -->
        <div class="user-panel">
            <h2>Carrito de Compras</h2>
            <div class="cart-items">
                <div class="form-group">
                    <label for="cartTotal">Total de la Compra:</label>
                    <input type="number" id="cartTotal" value="100" readonly>
                </div>
                <div class="form-group">
                    <label for="couponCode">Aplicar Cupón:</label>
                    <input type="text" id="couponCode" placeholder="Ingrese código de cupón">
                    <button onclick="applyCoupon()">Aplicar</button>
                </div>
                <div id="cartSummary" class="cart-summary">
                    <!-- El resumen del carrito se mostrará aquí -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let promotions = [];
        let activePromotions = new Set();

        // Función para crear una nueva promoción
        document.getElementById('promotionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const promotion = {
                id: Date.now(),
                name: document.getElementById('promoName').value,
                type: document.getElementById('promoType').value,
                value: parseFloat(document.getElementById('promoValue').value),
                code: document.getElementById('promoCode').value.toUpperCase(),
                expiry: document.getElementById('promoExpiry').value,
                active: true
            };

            promotions.push(promotion);
            activePromotions.add(promotion.code);
            
            // Mostrar en consola
            console.log('Nueva promoción creada:', promotion);
            
            updatePromotionsList();
            this.reset();
        });

        // Función para actualizar la lista de promociones
        function updatePromotionsList() {
            const promotionList = document.getElementById('promotionList');
            promotionList.innerHTML = '';

            promotions.forEach(promo => {
                const card = document.createElement('div');
                card.className = 'promotion-card';
                
                const expiryDate = new Date(promo.expiry);
                const isExpired = expiryDate < new Date();
                
                card.innerHTML = `
                    <h3>${promo.name}</h3>
                    <p>Código: <strong>${promo.code}</strong></p>
                    <p>Tipo: ${promo.type === 'percentage' ? 'Porcentual' : 
                              promo.type === 'fixed' ? 'Fijo' : '2x1'}</p>
                    <p>Valor: ${promo.type === 'percentage' ? promo.value + '%' : 
                              promo.type === 'fixed' ? '$' + promo.value : 'N/A'}</p>
                    <p>Expira: ${promo.expiry}</p>
                    <p class="${isExpired ? 'status-inactive' : 'status-active'}">
                        ${isExpired ? 'Expirado' : 'Activo'}
                    </p>
                    <button onclick="togglePromotion(${promo.id})">${promo.active ? 'Desactivar' : 'Activar'}</button>
                `;
                
                promotionList.appendChild(card);
            });
        }

        // Función para toggle promoción
        function togglePromotion(id) {
            const promotion = promotions.find(p => p.id === id);
            if (promotion) {
                promotion.active = !promotion.active;
                if (promotion.active) {
                    activePromotions.add(promotion.code);
                } else {
                    activePromotions.delete(promotion.code);
                }
                console.log(`Promoción ${promotion.code} ${promotion.active ? 'activada' : 'desactivada'}`);
                updatePromotionsList();
            }
        }

        // Función para aplicar cupón
        function applyCoupon() {
            const code = document.getElementById('couponCode').value.toUpperCase();
            const cartTotal = parseFloat(document.getElementById('cartTotal').value);
            const cartSummary = document.getElementById('cartSummary');
            
            const promotion = promotions.find(p => p.code === code && p.active);
            
            if (!promotion) {
                cartSummary.innerHTML = `
                    <div class="notification error">
                        Cupón inválido o inactivo
                    </div>
                `;
                console.log('Intento de aplicar cupón inválido:', code);
                return;
            }

            let discount = 0;
            let finalPrice = cartTotal;

            switch (promotion.type) {
                case 'percentage':
                    discount = cartTotal * (promotion.value / 100);
                    finalPrice = cartTotal - discount;
                    break;
                case 'fixed':
                    discount = promotion.value;
                    finalPrice = cartTotal - discount;
                    break;
                case 'buyOneGetOne':
                    discount = cartTotal / 2;
                    finalPrice = cartTotal - discount;
                    break;
            }

            cartSummary.innerHTML = `
                <div class="notification success">
                    <p>Cupón aplicado: ${promotion.name}</p>
                    <p>Descuento aplicado: $${discount.toFixed(2)}</p>
                    <p>Total final: $${finalPrice.toFixed(2)}</p>
                </div>
            `;

            console.log('Cupón aplicado:', {
                codigo: code,
                descuento: discount,
                totalFinal: finalPrice
            });
        }

        // Agregar algunas promociones de ejemplo
        const examplePromotions = [
            {
                id: 1,
                name: "Descuento de Verano",
                type: "percentage",
                value: 20,
                code: "VERANO20",
                expiry: "2024-12-31",
                active: true
            },
            {
                id: 2,
                name: "Descuento Fijo",
                type: "fixed",
                value: 50,
                code: "FIJO50",
                expiry: "2024-12-31",
                active: true
            }
        ];

        examplePromotions.forEach(promo => {
            promotions.push(promo);
            activePromotions.add(promo.code);
        });

        updatePromotionsList();
    </script>
</body>
</html>